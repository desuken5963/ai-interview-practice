# テスト実行方法

このドキュメントでは、バックエンドのテスト実行方法について説明します。

## テストの種類

プロジェクトには以下の3種類のテストがあります：

1. **単体テスト**：各コンポーネントを個別にテストします
2. **統合テスト**：複数のコンポーネントを組み合わせてテストします
3. **E2Eテスト**：APIエンドポイントからデータベースまでの全体フローをテストします

## テスト環境のセットアップ

テストを実行する前に、テスト用の環境をセットアップする必要があります：

```bash
# プロジェクトルートディレクトリで実行
make test-docker-up
make test-setup
```

このコマンドは以下の処理を行います：
- テスト用のDocker環境を起動
- テスト用データベース（`ai_interview_test`）へのマイグレーション適用

## テストの実行

### 全てのテストを実行

```bash
# プロジェクトルートディレクトリで実行
make test
```

### 単体テストのみ実行

```bash
# プロジェクトルートディレクトリで実行
make test-unit
```

### 統合テストのみ実行

```bash
# プロジェクトルートディレクトリで実行
make test-integration
```

### E2Eテストのみ実行

```bash
# プロジェクトルートディレクトリで実行
make test-e2e
```

## テスト設定のカスタマイズ

テスト設定は `docker-compose.test.yml` ファイルで管理されています。必要に応じて設定を変更できます。

## テスト環境の停止

テスト完了後、テスト環境を停止するには以下のコマンドを実行します：

```bash
# プロジェクトルートディレクトリで実行
make test-docker-down
```

## テストデータ

テストデータは `test/data` ディレクトリに配置されています：

- `company_jobs.sql`：企業と求人情報のテストデータ

テストデータを本番データベースに投入する場合は以下のコマンドを使用します：

```bash
# プロジェクトルートディレクトリで実行
make test-data-company-jobs
```

## テストコードの構成

テストコードは以下のように構成されています：

1. **単体テスト**：各実装ファイルと同じディレクトリに配置
   - 例：`internal/repository/company/create_test.go`

2. **統合テスト**：`test/integration` ディレクトリに配置
   - 例：`test/integration/company_repository_test.go`

3. **E2Eテスト**：`test/e2e` ディレクトリに配置
   - 例：`test/e2e/company_api_test.go` 